import os
import json
import pybase64


# Just a simple script that checks the default docker installation
# folder at ~/.docker and checks if the default settings file is in use,
# then decodes any base64 items
def main():
    f = os.environ['HOME'] + "/.docker/config.json"
    print(f"[+] Checking default docker installation directory exists ({f})")
    if os.path.exists(f):
        with open(f) as f_open:
            print("[+] Opening config.json and checking for "
                        "base64 encoded passwords")
            load_data = json.load(f_open)
            print("[+] Results: ")
            for v, k in load_data['auths'].items():
                if "auth" in k:
                    if "=" in str(k['auth']):
                        p = pybase64.b64decode(k['auth']).decode('utf-8').replace('\n', '')
                        print(f"\n[+] Site: {v}")
                        print(f"[+] Password: {p}")
    elif os.path.exists(f) is False:
        print("[+] Filepath does not exist, either docker is not installed or it has a different"
                " settings path")


if __name__ == '__main__':
    main()
